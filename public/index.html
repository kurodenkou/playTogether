<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>playTogether</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>

<!-- ══════════════════════════════════════════════════════════════════════════
     LOBBY VIEW
══════════════════════════════════════════════════════════════════════════════ -->
<div id="view-lobby" class="view">
  <div class="lobby-card">
    <h1>playTogether</h1>
    <p class="tagline">JS emulator platform · rollback netcode</p>

    <div class="field-group">
      <label for="playerName">Your name</label>
      <input type="text" id="playerName" placeholder="Player" maxlength="24" autocomplete="off">
    </div>

    <div class="lobby-actions">
      <button id="createRoomBtn" class="primary">Create Room</button>
    </div>

    <div class="lobby-divider">or join existing</div>

    <div class="join-group">
      <input type="text" id="roomCodeInput" placeholder="ROOM CODE" maxlength="6"
             autocomplete="off" spellcheck="false">
      <button id="joinRoomBtn">Join</button>
    </div>

    <div id="status-lobby" class="status hidden"></div>
  </div>
</div>

<!-- ══════════════════════════════════════════════════════════════════════════
     ROOM VIEW
══════════════════════════════════════════════════════════════════════════════ -->
<div id="view-room" class="view hidden">

  <!-- Top bar ──────────────────────────────────────────────────────────── -->
  <div class="room-topbar">
    <span class="logo">playTogether</span>

    <div class="room-code">
      <span class="label">ROOM</span>
      <span id="roomIdDisplay">——</span>
    </div>

    <span class="spacer"></span>
    <span class="gamepad-indicator hidden" id="gamepadIndicator"></span>
    <span class="player-slot-label" id="playerSlotLabel"></span>
    <button class="danger" id="leaveRoomBtn">Leave</button>
  </div>

  <!-- Body ─────────────────────────────────────────────────────────────── -->
  <div class="room-body">

    <!-- Canvas + stats ─────────────────────────────────────────────────── -->
    <div class="canvas-area">
      <div class="canvas-wrapper">

        <!-- Pre-game overlay ─────────────────────────────────────────── -->
        <div id="preGamePanel">
          <h2>Waiting for host</h2>
          <p>Share the room code with a friend.<br>
             The host picks a game and clicks Start.</p>

          <div class="controls-hint">
            <strong>Pong</strong> — ↑↓ / W·S to move · first to 7 wins<br>
            <strong>NES</strong> &nbsp;— Arrows/WASD · Z=A · X=B · Enter=Start · Shift=Select<br>
            <strong>Gamepad</strong> — D-pad/stick · A=A · B/X=B · Start · Select
          </div>
        </div>

        <!-- Game canvas (hidden until started) ───────────────────────── -->
        <div id="gamePanel" class="hidden" style="position:relative;">
          <canvas id="gameCanvas"></canvas>

          <!-- Loading overlay (shown while fetching ROM / initialising) -->
          <div id="loadingOverlay" class="loading-overlay hidden">Loading…</div>
        </div>

      </div><!-- /canvas-wrapper -->

      <!-- Rollback stats HUD -->
      <div class="stats-hud">
        <span>Frame <b id="hudFrame">—</b></span>
        <span>Confirmed <b id="hudConfirmed">—</b></span>
        <span>Rollbacks <b id="hudRollbacks">—</b></span>
        <span>Max depth <b id="hudMaxDepth">—</b></span>
      </div>
    </div><!-- /canvas-area -->

    <!-- Side panel ─────────────────────────────────────────────────────── -->
    <div class="side-panel">

      <!-- Players ──────────────────────────────────────────────────────── -->
      <div class="panel-section">
        <h3>Players</h3>
        <ul class="player-list" id="playerList"></ul>
      </div>

      <!-- Game settings + host controls ───────────────────────────────── -->
      <div class="panel-section">
        <h3>Game</h3>

        <div class="field-group" style="margin-bottom:10px;">
          <label for="gameTypeSelect">Type</label>
          <select id="gameTypeSelect">
            <option value="pong">Pong (built-in demo)</option>
            <option value="nes">NES emulator</option>
          </select>
        </div>

        <div id="romUrlRow" class="field-group hidden" style="margin-bottom:10px;">
          <label for="romUrlInput">ROM URL (.nes)</label>
          <input type="text" id="romUrlInput" placeholder="https://example.com/game.nes"
                 autocomplete="off" spellcheck="false">
          <span class="field-hint">The URL is fetched server-side (no CORS issues).</span>
        </div>

        <div class="host-controls">
          <button id="startGameBtn" class="primary hidden">Start Game</button>
          <button id="rematchBtn" class="hidden">Rematch</button>
        </div>
      </div>

      <!-- Chat ─────────────────────────────────────────────────────────── -->
      <div class="panel-section chat-section">
        <h3>Chat</h3>
        <div id="chatLog"></div>
        <div class="chat-input-row">
          <input type="text" id="chatInput" placeholder="Message…" maxlength="300" autocomplete="off">
          <button id="sendChatBtn">↵</button>
        </div>
      </div>

    </div><!-- /side-panel -->
  </div><!-- /room-body -->
</div><!-- /view-room -->

<!-- ── Scripts ────────────────────────────────────────────────────────────── -->
<!-- jsnes browser bundle (served from node_modules by the server) -->
<script src="/js/jsnes.js"></script>
<!-- Platform scripts (load order: dependencies before dependents) -->
<script src="js/rollback.js"></script>
<script src="js/demo-game.js"></script>
<script src="js/nes-adapter.js"></script>
<script src="js/network.js"></script>
<script src="js/input.js"></script>
<script src="js/app.js"></script>

</body>
</html>
